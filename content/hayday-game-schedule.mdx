---
title: Cracking the Scheduling Code in Hay Day
publishedAt: 2024-04-23
summary: A deep dive into the scheduling problem in the Hay Day game.
---

It's has beed a long time since my last post.  I was researching the scheduling problem in the Hay Day game for a while. And now is the good time to share the result with you.

## What is Hay Day?

Hay Day is a popular mobile game created by Supercell in 2012. It is a farming simulator where you can plant crops and trees, raise animals, sell products, compete in derbies, and so much more. Hay Day is a freemium game so all features of the game are open to players who choose not to buy in-app-purchases.

<YouTubeEmbed videoId="mSev84nF1HA"/>

In Hay Day, your main job is to make products based on the orders that you receive from the customers. When you complete the order, you will get coins and experience points. The orders are generated randomly and you can choose to accept or decline them. The orders are combine of products that you can make in the game.

<Image src="/images/hayday-game-schedule/hayday-orders.png" width="800" height="700" alt="orders" />

To make products in the game, you need two main resources: goods (or product) and machine. Each goods has a production time, a machine that can produce it and goods that are required to make it. For example, to make a _chicken feed_, you need _2 wheat_ and _1 corn_. The production time of a _chicken feed_ is _5 minutes_ and it can be made in the _feed mill_. And 

For a deep dive into the game, you can check out the [Hay Day Wiki](https://hayday.fandom.com/wiki/Hay_Day_Wiki). 

<Image src="/images/hayday-game-schedule/chart-dark.png" width="1100" height="800" className="hidden dark:block" alt="chart" />
<Image src="/images/hayday-game-schedule/chart-light.png" className="dark:hidden block" width="1100" height="800" alt="chart" />

## The problem

Hay Day is a really easy game, at least when I started playing. Wheat is planted, gathered, and sold. Alternately, you may use wheat to produce and sell bread. However, as the game progresses, you will acquire additional machines, goods, and orders. 


<HaydayGameSchedule.Chart/>

As you can see, just in level 20 of the game, we have 40 goods and 10 machines. The permutation of the goods and machines is huge. At this point, the scheduling issue arises.

So what do we want to solve here? Let clarify the problem:

- An order is a set of goods that need to be made.
- A machine can only produce one good at a time.
- A machine can only produce a good if it has all the required goods.
- A good can only be produced on a specific machine.

Our target:

- Given a set of orders, find a schedule that maximize the **makespan** of the orders.
- The makespan is the time between the start of the first order and the end of the last order.

A simple scheduling to make a order with two egg will look like this:

<Image src="/images/hayday-game-schedule/machine_schedule.png" width="1200" height="400" alt="scheduling" />

But in reality, the scheduling is more complex. Here is the image showing the scheduling of 2 orders with 4 goods:

<Image src="/images/hayday-game-schedule/complex_machine_schedule.png" width="1200" height="400" alt="complex" />

Specifically, our problem is a **Flexible Job Shop Scheduling Problem (FJSP)**. The Flexible Job Shop Scheduling Problem  is a variations of the [Job-shop scheduling problem (JSSP)](https://en.wikipedia.org/wiki/Job-shop_scheduling). 

The JSSP can be formulated as follows: 

- For $n$ jobs, each one is composed of several operations that must be executed on $m$ machines. For each operation uses only one machine for a fixed duration.
- Each machine can process at most one operation at a time and once an operation starts processing on a given machine, it must complete processing on that same machine without any interruption.
- The operations of a given job have to be processed in a given set of order.
- The problemâ€™s main aim is to schedule the activities or operations of the jobs on the machines such that the total time to finish all jobs, that is the makespan, is minimized. 

The term makespan refers to the cumulative time to complete all the operations of all jobs on all machines. It is a measure of the time period from the starting time of the first operation to the ending time of the last operation. Sometimes there may be multiple solutions that have the minimum makespan, but the goal is to find out any one of them: it is not necessary to find all possible optimum solutions



## Solution

So how can we solve this problem? There are many algorithms that can be used to solve the FJSP. Some of them are:

- Genetic Algorithm
- Simulated Annealing
- Tabu Search
- Ant Colony Optimization

And many more. But in this post, I will use Integer Programming to solve the problem. Specifically, I will use Google's OR-Tools to solve the problem.

OR-Tools is an open-source, fast, and portable software suite for solving combinatorial optimization problems. It is a set of algorithms and techniques for solving optimization problems. It includes a constraint programming solver, a linear programming solver, and a vehicle routing solver.



## Resource

- [Hay Day Good list](https://hayday.fandom.com/wiki/Goods_List)
- [Hay Day Production Buildings List](https://hayday.fandom.com/wiki/Production_Buildings_List)
- [Google's OR-Tools Code for Flexible Job Shop Scheduling](https://github.com/google/or-tools/blob/stable/examples/python/flexible_job_shop_sat.py)
